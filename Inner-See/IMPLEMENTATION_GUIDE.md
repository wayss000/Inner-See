# å¿ƒæ¢App SQLiteæ•°æ®åº“é›†æˆå®ç°æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æˆåŠŸå®ç°äº†å°†1471é“å¿ƒç†æµ‹è¯•é¢˜ç›®é›†æˆåˆ°SQLiteæ•°æ®åº“ä¸­ï¼Œå¹¶æä¾›äº†å®Œæ•´çš„æ‡’åŠ è½½åŠŸèƒ½ï¼Œç¡®ä¿ç”¨æˆ·å®‰è£…Appåå³å¯ä½¿ç”¨å®Œæ•´çš„é¢˜åº“ã€‚

## ğŸ“ æ ¸å¿ƒæ–‡ä»¶ç»“æ„

```
Inner-See/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â”œâ”€â”€ PrepackagedDatabase.ts      # é¢„æ‰“åŒ…æ•°æ®åº“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ LazyLoadingQuestionService.ts # æ‡’åŠ è½½é¢˜ç›®æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ QuestionDataSeeder.ts       # é¢˜ç›®æ•°æ®æ’­ç§å™¨
â”‚   â”‚   â””â”€â”€ DatabaseBuilder.ts          # æ•°æ®åº“æ„å»ºå·¥å…·
â”‚   â”œâ”€â”€ entities/                       # æ•°æ®å®ä½“å®šä¹‰
â”‚   â”œâ”€â”€ LazyLoadingAppInitializer.ts   # æ‡’åŠ è½½åº”ç”¨åˆå§‹åŒ–å™¨
â”‚   â””â”€â”€ services/
â”‚       â””â”€â”€ LazyLoadingQuestionService.ts
â”œâ”€â”€ screens/p-test_category/index.tsx   # é›†æˆæ‡’åŠ è½½çš„æµ‹è¯•é¡µé¢
â”œâ”€â”€ app/_layout.tsx                     # é›†æˆè‡ªåŠ¨åˆå§‹åŒ–çš„åº”ç”¨å¸ƒå±€
â””â”€â”€ questions/é¢˜ç›®åº“.md                 # 1471é“é¢˜ç›®çš„åŸå§‹æ•°æ®
```

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. é¢„æ‰“åŒ…æ•°æ®åº“æ–¹æ¡ˆ

#### PrepackagedDatabase.ts
- **åŠŸèƒ½**ï¼šç®¡ç†é¢„æ‰“åŒ…çš„SQLiteæ•°æ®åº“æ–‡ä»¶
- **ç‰¹ç‚¹**ï¼š
  - æ£€æŸ¥é¢„æ‰“åŒ…æ•°æ®åº“æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  - ä¸å­˜åœ¨æ—¶å›é€€åˆ°åŠ¨æ€åˆ›å»º
  - ç¡®ä¿æ•°æ®è¡¨ç»“æ„å®Œæ•´

#### æ ¸å¿ƒä»£ç ï¼š
```typescript
async initialize(): Promise<void> {
  const dbExists = await this.checkDatabaseExists();
  
  if (dbExists) {
    // ä½¿ç”¨é¢„æ‰“åŒ…çš„æ•°æ®åº“æ–‡ä»¶
    this.db = await openDatabaseAsync('xin-tan.db');
  } else {
    // å›é€€åˆ°åŠ¨æ€åˆ›å»ºæ•°æ®åº“
    await this.createDatabase();
  }
}
```

### 2. æ‡’åŠ è½½é¢˜ç›®æœåŠ¡

#### LazyLoadingQuestionService.ts
- **åŠŸèƒ½**ï¼šæä¾›åˆ†æ‰¹åŠ è½½é¢˜ç›®çš„æœåŠ¡
- **ç‰¹ç‚¹**ï¼š
  - æ”¯æŒå¤šç§é¢˜å‹ï¼ˆé‡è¡¨é¢˜ã€å•é€‰é¢˜ã€å¤šé€‰é¢˜ã€é€»è¾‘é¢˜ç­‰ï¼‰
  - åˆ†æ‰¹åŠ è½½ï¼Œé¿å…ä¸€æ¬¡æ€§åŠ è½½1471é“é¢˜ç›®
  - æ”¯æŒæœç´¢å’Œæ¨èåŠŸèƒ½

#### æ ¸å¿ƒæ–¹æ³•ï¼š
```typescript
// åˆ†æ‰¹è·å–é¢˜ç›®
async getQuestionsByTestType(testTypeId: string, offset: number = 0): Promise<Question[]>

// æ£€æŸ¥æ˜¯å¦è¿˜æœ‰æ›´å¤šé¢˜ç›®
async hasMoreQuestions(testTypeId: string, offset: number): Promise<boolean>

// æœç´¢é¢˜ç›®
async searchQuestions(keyword: string, testTypeId?: string): Promise<Question[]>
```

### 3. åº”ç”¨åˆå§‹åŒ–å™¨

#### LazyLoadingAppInitializer.ts
- **åŠŸèƒ½**ï¼šæ•´åˆæ•°æ®åº“åˆå§‹åŒ–å’Œæ•°æ®éªŒè¯
- **ç‰¹ç‚¹**ï¼š
  - åˆå§‹åŒ–é¢„æ‰“åŒ…æ•°æ®åº“
  - éªŒè¯æ•°æ®åº“å†…å®¹å®Œæ•´æ€§
  - æä¾›å›é€€æ•°æ®æœºåˆ¶

### 4. æ•°æ®åº“æ„å»ºå·¥å…·

#### DatabaseBuilder.ts
- **åŠŸèƒ½**ï¼šå¼€å‘é˜¶æ®µæ„å»ºé¢„æ‰“åŒ…æ•°æ®åº“
- **ç‰¹ç‚¹**ï¼š
  - ä»Markdownæ–‡ä»¶å¯¼å…¥1471é“é¢˜ç›®
  - ç”Ÿæˆå¯éšAppæ‰“åŒ…çš„SQLiteæ–‡ä»¶
  - æä¾›æ•°æ®ç»Ÿè®¡å’ŒéªŒè¯åŠŸèƒ½

## ğŸ“Š æ•°æ®åº“ç»“æ„

### æ ¸å¿ƒæ•°æ®è¡¨
- **test_types**ï¼š6ä¸ªæµ‹è¯•ç±»å‹ï¼ˆå¿ƒç†å¥åº·ã€äººæ ¼ç‰¹è´¨ã€è®¤çŸ¥èƒ½åŠ›ç­‰ï¼‰
- **questions**ï¼š1471é“é¢˜ç›®ï¼Œæ”¯æŒJSONæ ¼å¼çš„é€‰é¡¹å’Œè¯„åˆ†
- **users**ï¼šç”¨æˆ·ä¿¡æ¯å­˜å‚¨
- **user_test_records**ï¼šæµ‹è¯•è®°å½•ç®¡ç†
- **user_answers**ï¼šç­”é¢˜æ•°æ®å­˜å‚¨

### é¢˜ç›®æ•°æ®ç»“æ„
```typescript
interface Question {
  id: string;              // é¢˜ç›®å”¯ä¸€æ ‡è¯†
  questionId: string;      // é¢˜ç›®ç¼–å·ï¼ˆå¦‚Q-MH-001ï¼‰
  testTypeId: string;      // æ‰€å±æµ‹è¯•ç±»å‹
  questionType: string;    // é¢˜å‹ï¼ˆé‡è¡¨é¢˜ã€å•é€‰é¢˜ç­‰ï¼‰
  questionText: string;    // é¢˜ç›®å†…å®¹
  options: string;         // é€‰é¡¹ï¼ˆJSONæ ¼å¼ï¼‰
  scoreMapping: string;    // åˆ†æ•°æ˜ å°„ï¼ˆJSONæ ¼å¼ï¼‰
  sourceReference: string; // é¢˜ç›®æ¥æº
  aiReviewStatus: string;  // AIå®¡æ ¸çŠ¶æ€
  sortOrder: number;       // æ’åºåºå·
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å®‰è£…ä¾èµ–
```bash
cd Inner-See
npm install
```

### 2. åº”ç”¨åˆå§‹åŒ–
```typescript
import { LazyLoadingAppInitializer } from './src/LazyLoadingAppInitializer';

// åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
await LazyLoadingAppInitializer.getInstance().initializeApp();
```

### 3. é¡µé¢æ•°æ®è¯»å–
```typescript
import { LazyLoadingQuestionService } from './src/services/LazyLoadingQuestionService';

const questionService = LazyLoadingQuestionService.getInstance();

// è·å–æµ‹è¯•ç±»å‹åˆ—è¡¨
const testTypes = await questionService.getTestTypes();

// åˆ†æ‰¹è·å–é¢˜ç›®ï¼ˆæ‡’åŠ è½½ï¼‰
const questions = await questionService.getQuestionsByTestType('CAT-001', 0);
```

### 4. å¼€å‘é˜¶æ®µæ„å»ºæ•°æ®åº“
```typescript
import { DatabaseBuilder } from './src/database/DatabaseBuilder';

const builder = DatabaseBuilder.getInstance();

// æ„å»ºé¢„æ‰“åŒ…æ•°æ®åº“
await builder.buildPrepackagedDatabase();

// ä»Markdownå¯¼å…¥å®Œæ•´é¢˜åº“
await builder.importQuestionsFromMarkdown();

// å¯¼å‡ºç»Ÿè®¡ä¿¡æ¯
const stats = await builder.exportDatabaseStats();
```

## ğŸ¯ å®ç°æ•ˆæœ

### âœ… å·²å®Œæˆçš„åŠŸèƒ½
1. **å®Œæ•´çš„1471é“é¢˜ç›®é›†æˆ**
   - 6ä¸ªæµ‹è¯•ç±»å‹ï¼Œ1471é“é¢˜ç›®å…¨éƒ¨æ”¯æŒ
   - åŒ…å«é‡è¡¨é¢˜ã€å•é€‰é¢˜ã€å¤šé€‰é¢˜ã€é€»è¾‘é¢˜ç­‰å¤šç§é¢˜å‹
   - å®Œæ•´çš„é¢˜ç›®ä¿¡æ¯ï¼šé€‰é¡¹ã€è¯„åˆ†æ ‡å‡†ã€æ¥æºç­‰

2. **é¢„æ‰“åŒ…æ•°æ®åº“æ–¹æ¡ˆ**
   - ç”¨æˆ·å®‰è£…åç«‹å³å¯ç”¨ï¼Œæ— éœ€é¦–æ¬¡å¯åŠ¨å¯¼å…¥
   - æ”¯æŒå›é€€æœºåˆ¶ï¼Œç¡®ä¿åº”ç”¨ç¨³å®šæ€§
   - æ•°æ®åº“æ–‡ä»¶éšAppä¸€èµ·æ‰“åŒ…å‘å¸ƒ

3. **æ‡’åŠ è½½åŠŸèƒ½å®ç°**
   - åˆ†æ‰¹åŠ è½½é¢˜ç›®ï¼Œé¿å…æ€§èƒ½é—®é¢˜
   - æ”¯æŒæ»šåŠ¨åŠ è½½æ›´å¤š
   - æä¾›æœç´¢å’Œæ¨èåŠŸèƒ½

4. **æµ‹è¯•é¡µé¢é›†æˆ**
   - æ›´æ–°äº†p-test_categoryé¡µé¢
   - æ”¯æŒä»æ•°æ®åº“åŠ¨æ€è·å–æµ‹è¯•ç±»å‹
   - å®Œæ•´çš„é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€

### ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–
- **æ‡’åŠ è½½**ï¼šæ¯æ‰¹åªåŠ è½½20é“é¢˜ç›®ï¼Œé¿å…å†…å­˜å ç”¨è¿‡é«˜
- **é¢„æ‰“åŒ…**ï¼šé¿å…é¦–æ¬¡å¯åŠ¨æ—¶çš„æ•°æ®å¯¼å…¥æ—¶é—´
- **ç¼“å­˜æœºåˆ¶**ï¼šæ•°æ®åº“è¿æ¥å¤ç”¨ï¼Œæé«˜è®¿é—®æ•ˆç‡
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„å›é€€æœºåˆ¶ï¼Œç¡®ä¿åº”ç”¨ç¨³å®šæ€§

## ğŸ” æµ‹è¯•éªŒè¯

### æ•°æ®åº“éªŒè¯
```typescript
// éªŒè¯æ•°æ®åº“å®Œæ•´æ€§
const isValid = await questionService.validateDatabaseIntegrity();
console.log(`æ•°æ®åº“çŠ¶æ€: ${isValid ? 'æ­£å¸¸' : 'å¼‚å¸¸'}`);

// è·å–ç»Ÿè®¡ä¿¡æ¯
const stats = await questionService.getDatabaseStats();
console.log(`æµ‹è¯•ç±»å‹: ${stats.testTypes}ä¸ª`);
console.log(`é¢˜ç›®æ•°é‡: ${stats.questions}é“`);
```

### åŠŸèƒ½æµ‹è¯•
1. **å¯åŠ¨æµ‹è¯•**ï¼šéªŒè¯åº”ç”¨å¯åŠ¨æ—¶æ•°æ®åº“åˆå§‹åŒ–
2. **æ•°æ®è¯»å–**ï¼šéªŒè¯æµ‹è¯•ç±»å‹å’Œé¢˜ç›®çš„æ­£ç¡®è¯»å–
3. **æ‡’åŠ è½½æµ‹è¯•**ï¼šéªŒè¯åˆ†æ‰¹åŠ è½½åŠŸèƒ½
4. **æœç´¢åŠŸèƒ½**ï¼šéªŒè¯é¢˜ç›®æœç´¢å’Œæ¨èåŠŸèƒ½

## ğŸ“ æ³¨æ„äº‹é¡¹

### å¼€å‘ç¯å¢ƒè¦æ±‚
- Node.js 16+ ç‰ˆæœ¬
- Expo CLI ç¯å¢ƒ
- TypeScript é…ç½®æ”¯æŒ ES2015+

### æ•°æ®åº“æ–‡ä»¶ç®¡ç†
- é¢„æ‰“åŒ…çš„ `xin-tan.db` æ–‡ä»¶éœ€è¦æ”¾åœ¨æ­£ç¡®ä½ç½®
- å¼€å‘é˜¶æ®µä½¿ç”¨ DatabaseBuilder ç”Ÿæˆæ•°æ®åº“æ–‡ä»¶
- ç¡®ä¿æ•°æ®åº“æ–‡ä»¶éšAppä¸€èµ·æ‰“åŒ…å‘å¸ƒ

### æ€§èƒ½è€ƒè™‘
- æ‡’åŠ è½½æ‰¹æ¬¡å¤§å°å¯é…ç½®ï¼ˆé»˜è®¤20é“ï¼‰
- å»ºè®®åœ¨Wi-Fiç¯å¢ƒä¸‹é¦–æ¬¡ä½¿ç”¨
- æ”¯æŒç¦»çº¿ä½¿ç”¨ï¼Œæ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨

## ğŸ¯ æ€»ç»“

æœ¬å®ç°æˆåŠŸè§£å†³äº†ä»¥ä¸‹å…³é”®é—®é¢˜ï¼š

1. **æ•°æ®é‡å¤§**ï¼šé€šè¿‡æ‡’åŠ è½½é¿å…ä¸€æ¬¡æ€§åŠ è½½1471é“é¢˜ç›®çš„æ€§èƒ½é—®é¢˜
2. **ç”¨æˆ·ä½“éªŒ**ï¼šé¢„æ‰“åŒ…æ–¹æ¡ˆç¡®ä¿ç”¨æˆ·å®‰è£…åç«‹å³å¯ç”¨
3. **æ•°æ®å®Œæ•´æ€§**ï¼šå®Œæ•´çš„1471é“é¢˜ç›®ï¼Œæ”¯æŒå¤šç§é¢˜å‹
4. **æ‰©å±•æ€§**ï¼šæ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºåç»­åŠŸèƒ½æ‰©å±•
5. **éšç§ä¿æŠ¤**ï¼šæ‰€æœ‰æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¸Šä¼ æœåŠ¡å™¨

é¡¹ç›®ç°åœ¨å…·å¤‡äº†å®Œæ•´çš„å¿ƒé‡Œæµ‹è¯•æ•°æ®ç®¡ç†èƒ½åŠ›ï¼Œæ”¯æŒä¸“ä¸šçš„å¿ƒç†æµ‹è¯•åŠŸèƒ½ï¼ŒåŒæ—¶ä¿è¯äº†ç”¨æˆ·æ•°æ®çš„éšç§å®‰å…¨å’Œç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚